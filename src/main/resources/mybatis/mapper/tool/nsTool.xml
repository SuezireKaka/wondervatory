<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="www.wonder.vatory.tool.mapper.ToolMapper">
	<resultMap id="rmToolVO" extends="www.wonder.vatory.work.mapper.WorkMapper.rmWorkVO"
		type="www.wonder.vatory.tool.model.ToolVO">
		<result property="name" column="name" />
		<result property="xToolSize" column="x_tool_size" />
		<result property="yToolSize" column="y_tool_size" />
	</resultMap>
	
	<!-- public List<ToolVO> listAllFromSeries(
			@Param("seriesId") String seriesId,
			@Param("page") int page);
	<select id="listAllFromSeries" resultMap="rmToolVO">
		SELECT SQL_CALC_FOUND_ROWS *
		  from t_tool
		 where parent_id = #{seriesId}
		   and parent_type = 'series'
		 order by id DESC
		 limit #{paging.seriesLimit} offset #{paging.offset}
	</select>
	→ deprecated : 아래 매소드로 전부 통합  -->
	
	<!-- public List<ToolVO> listAllNextTools(@Param("seriesId") String seriesId,
			@Param("idPath") String idPath, @Param("paging") PagingDTO paging); -->
	<select id="listAllNextTools" resultMap="rmToolVO">
		SELECT SQL_CALC_FOUND_ROWS t.*, acc.id acc_id, acc.descrim acc_descrim
		  from t_tool t
		  Left outer join t_account acc
		    on t.writer_id = acc.id
		 where t.series_id = #{seriesId}
		   and t.id like CONCAT(#{idPath}, '____')
		 order by t.id DESC
		 limit #{paging.seriesLimit} offset #{paging.offset}
	</select>
	
	<!-- public ToolVO getToolById(@Param("toolId") String toolId); -->
	<select id="getToolById" resultMap="rmToolVO">
		SELECT t.*, acc.id acc_id, acc.descrim acc_descrim
		  from t_tool t
		  Left outer join t_account acc
		    on t.writer_id = acc.id
		 where t.id = #{toolId}
	</select>
	
	<!-- public int createToolSkin(@Param("writer") AccountVO writer,
			@Param("toolSkin") ToolVO toolSkin, @Param("seriesId") String seriesId);-->
	<insert id="createToolSkin">
		<selectKey keyProperty="toolSkin.id" resultType="String" order="BEFORE">
    		select concat(#{toolSkin.id}, NEXT_PK('s_tool'))
  		</selectKey>
		INSERT INTO t_tool(id, series_id, writer_id, h_tier, x_tool_size, y_tool_size, NAME)
		VALUES (#{toolSkin.id}, #{seriesId}, #{writer.id}, #{toolSkin.hTier}, #{toolSkin.xToolSize}, #{toolSkin.yToolSize}, #{toolSkin.name})
	</insert>
	
	<!-- public int updateToolSkin(@Param("toolSkin") ToolVO toolSkin);-->
	<update id="updateToolSkin">
		UPDATE t_tool
		   set name = #{toolSkin.name},
		       x_tool_size = #{toolSkin.xToolSize},
		       y_tool_size = #{toolSkin.yToolSize}
		 where id = #{toolSkin.id}
	</update>

</mapper>
